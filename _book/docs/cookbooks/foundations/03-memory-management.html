<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open-source frameworks, guides, and resources for AI development, collaboration, and creativity">
    <meta name="author" content="VibeHub">
    <title>Memory Management - VibeHub - Human √ó AI Creative Agency</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="/assets/highlight.css">
</head>
<body>
    <div class="book-container">
        <div class="book-header">
            <div class="book-header-content">
                <h1 class="book-title">VibeHub - Human √ó AI Creative Agency</h1>
                <div class="book-header-controls">
                    <input type="search" class="search-input" placeholder="Search..." id="search-input">
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                        <span class="theme-icon">üåì</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="book-body">
            <nav class="book-sidebar">
<div class="book-sidebar-content">
<div class="sidebar-section">
<h3 class="sidebar-section-title">üè† Welcome to CURATIONS</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/readme.html">Start Here</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curations.html">About CURATIONS</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curationsla.html">About CurationsLA</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üåü Core Initiatives</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/the-curators.html">The Curators (AI Personas)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/youth-curator-movement.html">Youth Curator Movement</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üé® How We Build</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/design-systems.html">Design Systems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/technical-architecture.html">Technical Architecture</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üìö The AI √ó Human Cookbook</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/README.html">About the Cookbook</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üå± Foundations: AI Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/01-interoperability-intro.html">Introduction to Interoperability</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/02-model-garden.html">Model Garden & Foundation Models</a>
</li>
<li class="sidebar-item active">
  <a href="/docs/cookbooks/foundations/03-memory-management.html">Memory Management</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üîç RAG & Knowledge Systems</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/01-rag-fundamentals.html">RAG Fundamentals</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/02-agentic-rag.html">Agentic RAG</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/03-graph-rag.html">GraphRAG</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/04-grounding.html">Grounding Techniques</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ü§ñ Agent Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/01-adk-overview.html">Agent Development Kits (ADK)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/02-agent-types.html">Agent Types</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/03-agent-models.html">Agent Models & Contracts</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/04-defining-llm-agents.html">Defining LLM Agents</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üõ†Ô∏è Tools & Integration</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/01-mcp.html">Model Context Protocol (MCP)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/02-a2a.html">Agent2Agent Protocol (A2A)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/03-tool-ecosystems.html">Tool Ecosystems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/04-agent-engines.html">AI Agent Engines</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üß† Advanced Prompting</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/README.html">Overview: Advanced Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/context-manipulation.html">Context Manipulation</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/emoji-protocol.html">Emoji Protocol</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/meta-prompting.html">Meta-Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/quantum-prompting.html">Quantum Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/temporal-debugging.html">Temporal Debugging</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üé® Business: Branding & Growth</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/README.html">Overview: AI-Powered Business</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/quantum-brand-engine.html">Quantum Brand Engine</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/brand-archaeology.html">Brand Archaeology</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/ai-discovery-singularity.html">AI Discovery Singularity (AAO)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/schema-mastery.html">Schema.org Mastery</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/creator-engine.html">Creator Singularity Engine</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">üöÄ Going Legendary</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/full-stack-ai.html">Full-Stack AI Applications</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/production-deployment.html">Production Deployment</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/scaling.html">Scaling Strategies</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/the-future.html">The Future We're Building</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ü§ù Get Involved</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/get-involved.html">How to Contribute, Learn & Collaborate</a>
</li>
</ul>
</div>
</div>
</nav>

            
            <main class="book-main">
                <div class="book-content">
                    <h1 id="memory-management-building-context-aware-agents">üß† Memory Management: Building Context-Aware Agents</h1>
<h2 id="seedling-concept">üå± Seedling Concept</h2>
<p><strong>Label</strong>: Giving Your Agents a Memory</p>
<p>Imagine talking to someone who forgets everything between conversations. Frustrating, right? Memory management transforms one-shot agents into context-aware assistants that remember user preferences, past interactions, and learned facts.</p>
<h2 id="what-is-memory-management">What is Memory Management?</h2>
<p>Memory management enables agents to:</p>
<ul>
<li>üìù <strong>Store key facts</strong> from conversations</li>
<li>üîç <strong>Retrieve relevant context</strong> when needed</li>
<li>üéØ <strong>Personalize experiences</strong> based on history</li>
<li>üîÑ <strong>Maintain continuity</strong> across sessions</li>
</ul>
<h2 id="generatememories-the-foundation">üí° GenerateMemories: The Foundation</h2>
<h3 id="how-memory-generation-works">How Memory Generation Works</h3>
<p><strong>GenerateMemories</strong> asynchronously extracts and stores key facts from conversation history:</p>
<div class="codehilite"><pre><span></span><code><span class="nl">User</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;I prefer non-stop flights and my dog&#39;s name is Fido&quot;</span>
<span class="w">                        </span><span class="err">‚îÇ</span>
<span class="w">                        </span><span class="err">‚ñº</span>
<span class="w">              </span><span class="p">[</span><span class="n">Memory</span><span class="w"> </span><span class="n">Extraction</span><span class="p">]</span>
<span class="w">                        </span><span class="err">‚îÇ</span>
<span class="w">            </span><span class="err">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="w">            </span><span class="err">‚ñº</span><span class="w">                       </span><span class="err">‚ñº</span>
<span class="w">    </span><span class="s">&quot;prefers_nonstop_flights&quot;</span><span class="w">  </span><span class="s">&quot;dog_name: Fido&quot;</span>
<span class="w">            </span><span class="err">‚îÇ</span><span class="w">                       </span><span class="err">‚îÇ</span>
<span class="w">            </span><span class="err">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="w">                        </span><span class="err">‚ñº</span>
<span class="w">                </span><span class="p">[</span><span class="n">Memory</span><span class="w"> </span><span class="n">Storage</span><span class="p">]</span>
<span class="w">                        </span><span class="err">‚îÇ</span>
<span class="w">                        </span><span class="err">‚ñº</span>
<span class="w">              </span><span class="p">[</span><span class="n">Vector</span><span class="w"> </span><span class="n">Database</span><span class="p">]</span>
</code></pre></div>

<h3 id="basic-implementation">Basic Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MemoryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages agent memory for personalized experiences</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_store</span> <span class="o">=</span> <span class="n">VectorStore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span> <span class="o">=</span> <span class="n">MemoryExtractor</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversation_history</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract key facts from conversation asynchronously</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract structured memories</span>
        <span class="n">memories</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">conversation_history</span><span class="p">)</span>

        <span class="c1"># Store each memory with metadata</span>
        <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_store</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="n">confidence</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">confidence</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">memories</span>
</code></pre></div>

<h3 id="real-world-example-travel-assistant">Real-World Example: Travel Assistant</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TravelAssistant</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process conversation and extract memories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="c1"># Extract and store memories asynchronously</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">generate_memories</span><span class="p">(</span><span class="n">messages</span> <span class="o">+</span> <span class="p">[</span><span class="n">response</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">book_flight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use memories to personalize booking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Retrieve relevant memories</span>
        <span class="n">preferences</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="s2">&quot;flight preferences&quot;</span><span class="p">,</span>
            <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>

        <span class="c1"># Build context from memories</span>
        <span class="n">context</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        User preferences:</span>
<span class="s2">        - Flight type: </span><span class="si">{</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flight_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;any&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        - Seat preference: </span><span class="si">{</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seat&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;not specified&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        - Airline loyalty: </span><span class="si">{</span><span class="n">preferences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;airline&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># Make personalized recommendation</span>
        <span class="n">recommendation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Find flights to </span><span class="si">{</span><span class="n">destination</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">recommendation</span>


<span class="c1"># Usage</span>
<span class="n">assistant</span> <span class="o">=</span> <span class="n">TravelAssistant</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user_123&quot;</span><span class="p">)</span>

<span class="c1"># First conversation</span>
<span class="k">await</span> <span class="n">assistant</span><span class="o">.</span><span class="n">process_conversation</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I prefer non-stop flights&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I always fly economy plus&quot;</span><span class="p">},</span>
<span class="p">])</span>

<span class="c1"># Later conversation - agent remembers!</span>
<span class="n">flight</span> <span class="o">=</span> <span class="k">await</span> <span class="n">assistant</span><span class="o">.</span><span class="n">book_flight</span><span class="p">(</span><span class="s2">&quot;Tokyo&quot;</span><span class="p">)</span>
<span class="c1"># Automatically considers: non-stop preference, economy plus</span>
</code></pre></div>

<h2 id="memory-categories">üåø Memory Categories</h2>
<h3 id="types-of-memories-to-extract">Types of Memories to Extract</h3>
<h4 id="1-preferences">1. Preferences</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;preference&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;prefers non-stop flights&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;travel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.95</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2-facts">2. Facts</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fact&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;dog&#39;s name is Fido&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;personal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="3-context">3. Context</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;working on machine learning project&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;professional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.85</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="4-relationships">4. Relationships</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;relationship&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;colleague named Sarah in marketing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;professional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.90</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="deep-dive-memory-retrieval">üî¨ Deep Dive: Memory Retrieval</h2>
<h3 id="similarity-search-for-context">Similarity Search for Context</h3>
<p>Memory retrieval uses vector similarity to find relevant past information:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AdvancedMemoryRetrieval</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">EmbeddingModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_db</span> <span class="o">=</span> <span class="n">VectorDatabase</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_relevant_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve memories most relevant to current query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert query to embedding</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">current_query</span><span class="p">)</span>

        <span class="c1"># Search for similar memories</span>
        <span class="n">similar_memories</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_db</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span>
            <span class="n">embedding</span><span class="o">=</span><span class="n">query_embedding</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span>  <span class="c1"># Minimum similarity score</span>
        <span class="p">)</span>

        <span class="c1"># Rank by relevance and recency</span>
        <span class="n">ranked_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_memories</span><span class="p">(</span>
            <span class="n">similar_memories</span><span class="p">,</span>
            <span class="n">factors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
                <span class="s2">&quot;recency&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
                <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ranked_memories</span>

    <span class="k">def</span> <span class="nf">rank_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memories</span><span class="p">,</span> <span class="n">factors</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rank memories by multiple factors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scored_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">memory</span><span class="o">.</span><span class="n">similarity</span> <span class="o">*</span> <span class="n">factors</span><span class="p">[</span><span class="s2">&quot;similarity&quot;</span><span class="p">]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recency_score</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">*</span> <span class="n">factors</span><span class="p">[</span><span class="s2">&quot;recency&quot;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">memory</span><span class="o">.</span><span class="n">confidence</span> <span class="o">*</span> <span class="n">factors</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">scored_memories</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">score</span><span class="p">,</span> <span class="n">memory</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">mem</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">mem</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scored_memories</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</code></pre></div>

<h3 id="memory-enhanced-prompt-construction">Memory-Enhanced Prompt Construction</h3>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">build_context_aware_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build prompt enriched with relevant memories</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve relevant memories</span>
    <span class="n">memories</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">retrieve_relevant_memories</span><span class="p">(</span>
        <span class="n">user_query</span><span class="p">,</span> 
        <span class="n">user_id</span>
    <span class="p">)</span>

    <span class="c1"># Format memories for prompt</span>
    <span class="n">memory_context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2"> (from </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">memories</span>
    <span class="p">])</span>

    <span class="c1"># Construct enhanced prompt</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    User Query: </span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span>

<span class="s2">    Relevant Context from Previous Interactions:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">memory_context</span><span class="si">}</span>

<span class="s2">    Please provide a personalized response that takes into account</span>
<span class="s2">    the user&#39;s preferences and history shown above.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">prompt</span>
</code></pre></div>

<h2 id="quick-win-minimal-memory-system">‚ö° Quick Win: Minimal Memory System</h2>
<h3 id="15-minute-implementation">15-Minute Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">SimpleMemorySystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lightweight memory system for quick implementation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_path</span><span class="o">=</span><span class="s2">&quot;memories.json&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span> <span class="o">=</span> <span class="n">storage_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_memories</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">extract_and_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">conversation_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple keyword-based memory extraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic extraction rules</span>
        <span class="n">memories</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Extract preferences</span>
        <span class="k">if</span> <span class="s2">&quot;prefer&quot;</span> <span class="ow">in</span> <span class="n">conversation_text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">memories</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;preference&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">conversation_text</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">})</span>

        <span class="c1"># Extract named entities (simple approach)</span>
        <span class="k">if</span> <span class="s2">&quot;named&quot;</span> <span class="ow">in</span> <span class="n">conversation_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;called&quot;</span> <span class="ow">in</span> <span class="n">conversation_text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">memories</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fact&quot;</span><span class="p">,</span>
                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">conversation_text</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">})</span>

        <span class="c1"># Store</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memories</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memories</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memories</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_memories</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">memories</span>

    <span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve memories for user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="c1"># Simple keyword matching</span>
            <span class="n">relevant</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">mem</span> <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">user_memories</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">mem</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
                       <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">relevant</span>

        <span class="k">return</span> <span class="n">user_memories</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>  <span class="c1"># Return recent memories</span>

    <span class="k">def</span> <span class="nf">save_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memories</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>


<span class="c1"># Usage</span>
<span class="n">memory</span> <span class="o">=</span> <span class="n">SimpleMemorySystem</span><span class="p">()</span>

<span class="c1"># Store memories</span>
<span class="n">memory</span><span class="o">.</span><span class="n">extract_and_store</span><span class="p">(</span>
    <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span>
    <span class="n">conversation_text</span><span class="o">=</span><span class="s2">&quot;I prefer dark mode and my cat is named Whiskers&quot;</span>
<span class="p">)</span>

<span class="c1"># Recall memories</span>
<span class="n">memories</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;preferences&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">memories</span><span class="p">)</span>
</code></pre></div>

<h2 id="advanced-multi-session-memory">üå≥ Advanced: Multi-Session Memory</h2>
<h3 id="persistent-context-across-sessions">Persistent Context Across Sessions</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MultiSessionMemory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Advanced memory system with session management</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Current session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_term</span> <span class="o">=</span> <span class="n">VectorStore</span><span class="p">()</span>  <span class="c1"># Persistent across sessions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">working_memory</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Active context (limited size)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load relevant long-term memories into working memory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get recent and important memories</span>
        <span class="n">recent</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_term</span><span class="o">.</span><span class="n">get_recent</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">important</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_term</span><span class="o">.</span><span class="n">get_by_importance</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

        <span class="c1"># Combine and deduplicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">working_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">(</span><span class="n">recent</span> <span class="o">+</span> <span class="n">important</span><span class="p">)[:</span><span class="mi">15</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_input</span><span class="p">,</span> <span class="n">agent_response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process interaction and update memories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add to short-term memory</span>
        <span class="n">interaction</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">user_input</span><span class="p">,</span>
            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">agent_response</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>

        <span class="c1"># Extract potential long-term memories</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_memorable</span><span class="p">(</span><span class="n">interaction</span><span class="p">):</span>
            <span class="n">memory</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_memory</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_term</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

            <span class="c1"># Add to working memory if important</span>
            <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">importance</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">working_memory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">end_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consolidate short-term memories into long-term storage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Analyze entire session</span>
        <span class="n">session_summary</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarize_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_term</span><span class="p">)</span>

        <span class="c1"># Store important insights</span>
        <span class="k">if</span> <span class="n">session_summary</span><span class="o">.</span><span class="n">has_insights</span><span class="p">():</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_term</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">session_summary</span><span class="p">)</span>

        <span class="c1"># Clear short-term and working memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">working_memory</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

<h2 id="key-takeaways">üéØ Key Takeaways</h2>
<ul>
<li><strong>Asynchronous extraction</strong> prevents memory generation from blocking responses</li>
<li><strong>Similarity search</strong> finds relevant context efficiently</li>
<li><strong>Categorization</strong> helps organize different types of memories</li>
<li><strong>Confidence scores</strong> indicate reliability of extracted information</li>
<li><strong>Multi-level memory</strong> (short-term, working, long-term) mirrors human cognition</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-privacy-first">1. Privacy First</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Always anonymize and secure memories</span>
<span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span>
    <span class="n">encryption</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">anonymize_pii</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">user_control</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Users can delete their memories</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="2-memory-decay">2. Memory Decay</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Implement forgetting for outdated information</span>
<span class="k">def</span> <span class="nf">apply_memory_decay</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
    <span class="n">age_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
    <span class="n">decay_factor</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="o">**</span> <span class="p">(</span><span class="n">age_days</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># 5% decay per month</span>
    <span class="n">memory</span><span class="o">.</span><span class="n">confidence</span> <span class="o">*=</span> <span class="n">decay_factor</span>
    <span class="k">return</span> <span class="n">memory</span>
</code></pre></div>

<h3 id="3-conflict-resolution">3. Conflict Resolution</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Handle contradictory memories</span>
<span class="k">def</span> <span class="nf">resolve_conflicts</span><span class="p">(</span><span class="n">old_memory</span><span class="p">,</span> <span class="n">new_memory</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">new_memory</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">old_memory</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
        <span class="c1"># Newer information typically more accurate</span>
        <span class="n">old_memory</span><span class="o">.</span><span class="n">superseded_by</span> <span class="o">=</span> <span class="n">new_memory</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">new_memory</span>
    <span class="k">return</span> <span class="n">old_memory</span>
</code></pre></div>

<h2 id="next-steps">Next Steps</h2>
<p>Continue to <a href="../rag/01-rag-fundamentals.md">RAG Fundamentals</a> to learn how to combine memory with retrieval-augmented generation for even more powerful agents.</p>
<hr />
<p>üí° <strong>Remember</strong>: Good memory management is about storing what matters and retrieving it when relevant‚Äîjust like human memory!</p>
                </div>
                
                <footer class="book-footer">
                    <div class="book-footer-content">
                        <p>Built with BookGen - A modern GitBook alternative</p>
                        <p>Generated on 2025-11-15 19:18:13</p>
                    </div>
                </footer>
            </main>
            
            
        </div>
    </div>
    
    <script src="/assets/script.js"></script>
</body>
</html>