<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open-source frameworks, guides, and resources for AI development, collaboration, and creativity">
    <meta name="author" content="VibeHub">
    <title>GraphRAG - VibeHub - Human Ã— AI Creative Agency</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="/assets/highlight.css">
</head>
<body>
    <div class="book-container">
        <div class="book-header">
            <div class="book-header-content">
                <h1 class="book-title">VibeHub - Human Ã— AI Creative Agency</h1>
                <div class="book-header-controls">
                    <input type="search" class="search-input" placeholder="Search..." id="search-input">
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                        <span class="theme-icon">ğŸŒ“</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="book-body">
            <nav class="book-sidebar">
<div class="book-sidebar-content">
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ  Welcome to CURATIONS</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/readme.html">Start Here</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curations.html">About CURATIONS</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curationsla.html">About CurationsLA</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸŒŸ Core Initiatives</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/the-curators.html">The Curators (AI Personas)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/youth-curator-movement.html">Youth Curator Movement</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¨ How We Build</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/design-systems.html">Design Systems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/technical-architecture.html">Technical Architecture</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ“š The AI Ã— Human Cookbook</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/README.html">About the Cookbook</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸŒ± Foundations: AI Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/01-interoperability-intro.html">Introduction to Interoperability</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/02-model-garden.html">Model Garden & Foundation Models</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/03-memory-management.html">Memory Management</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ” RAG & Knowledge Systems</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/01-rag-fundamentals.html">RAG Fundamentals</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/02-agentic-rag.html">Agentic RAG</a>
</li>
<li class="sidebar-item active">
  <a href="/docs/cookbooks/rag/03-graph-rag.html">GraphRAG</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/04-grounding.html">Grounding Techniques</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¤– Agent Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/01-adk-overview.html">Agent Development Kits (ADK)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/02-agent-types.html">Agent Types</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/03-agent-models.html">Agent Models & Contracts</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/04-defining-llm-agents.html">Defining LLM Agents</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ› ï¸ Tools & Integration</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/01-mcp.html">Model Context Protocol (MCP)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/02-a2a.html">Agent2Agent Protocol (A2A)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/03-tool-ecosystems.html">Tool Ecosystems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/04-agent-engines.html">AI Agent Engines</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ§  Advanced Prompting</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/README.html">Overview: Advanced Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/context-manipulation.html">Context Manipulation</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/emoji-protocol.html">Emoji Protocol</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/meta-prompting.html">Meta-Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/quantum-prompting.html">Quantum Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/temporal-debugging.html">Temporal Debugging</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¨ Business: Branding & Growth</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/README.html">Overview: AI-Powered Business</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/quantum-brand-engine.html">Quantum Brand Engine</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/brand-archaeology.html">Brand Archaeology</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/ai-discovery-singularity.html">AI Discovery Singularity (AAO)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/schema-mastery.html">Schema.org Mastery</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/creator-engine.html">Creator Singularity Engine</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸš€ Going Legendary</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/full-stack-ai.html">Full-Stack AI Applications</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/production-deployment.html">Production Deployment</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/scaling.html">Scaling Strategies</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/the-future.html">The Future We're Building</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¤ Get Involved</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/get-involved.html">How to Contribute, Learn & Collaborate</a>
</li>
</ul>
</div>
</div>
</nav>

            
            <main class="book-main">
                <div class="book-content">
                    <h1 id="graphrag-knowledge-graphs-for-ai-agents">ğŸ•¸ï¸ GraphRAG: Knowledge Graphs for AI Agents</h1>
<h2 id="flourishing-concept">ğŸŒ³ Flourishing Concept</h2>
<p><strong>Label</strong>: Understanding Relationships, Not Just Documents</p>
<p>GraphRAG enriches traditional RAG by understanding the <strong>explicit relationships</strong> between data points in a knowledge graph. Instead of just finding similar documents, GraphRAG leverages the connections and structure of your knowledge to provide richer, more contextual answers.</p>
<h2 id="what-is-graphrag">What is GraphRAG?</h2>
<h3 id="traditional-rag-vs-graphrag">Traditional RAG vs. GraphRAG</h3>
<div class="codehilite"><pre><span></span><code>Traditional RAG:                  GraphRAG:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Document 1â”‚                     â”‚Document 1â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                      â”‚ authored_by
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚Document 2â”‚                     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  Person  â”‚â”€relatesâ†’â”‚ Department â”‚
                                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ worked_on
â”‚Document 3â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                                 â”‚ Project  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Similarity search only         Relationship-aware retrieval
</code></pre></div>

<h3 id="why-graphrag-matters">Why GraphRAG Matters</h3>
<p><strong>Traditional RAG</strong>: "Find documents about Python web frameworks"<br />
- Returns: Documents mentioning Django, Flask, FastAPI</p>
<p><strong>GraphRAG</strong>: "Find documents about Python web frameworks"<br />
- Returns: Documents about frameworks<br />
- <strong>Plus</strong>: Related concepts (ASGI, WSGI)<br />
- <strong>Plus</strong>: Authors who contributed to multiple frameworks<br />
- <strong>Plus</strong>: Projects that compare frameworks<br />
- <strong>Plus</strong>: Dependencies between frameworks</p>
<h2 id="building-a-knowledge-graph">ğŸ’¡ Building a Knowledge Graph</h2>
<h3 id="graph-components">Graph Components</h3>
<h4 id="nodes-entities">Nodes (Entities)</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an entity in the knowledge graph&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>  <span class="c1"># person, document, concept, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span>

<span class="c1"># Examples</span>
<span class="n">person_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;person_123&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;person&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sarah Chen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Senior Engineer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;expertise&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span> <span class="s2">&quot;ML&quot;</span><span class="p">,</span> <span class="s2">&quot;Distributed Systems&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">document_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;doc_456&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Building Scalable APIs with FastAPI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;published&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;topics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;FastAPI&quot;</span><span class="p">,</span> <span class="s2">&quot;API Design&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">concept_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;concept_789&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;concept&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Asynchronous Programming&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;Programming Paradigm&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="edges-relationships">Edges (Relationships)</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Edge</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a relationship between entities&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="n">relation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="c1"># Examples</span>
<span class="n">authored_edge</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;person_123&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;doc_456&quot;</span><span class="p">,</span>
    <span class="n">relation</span><span class="o">=</span><span class="s2">&quot;AUTHORED&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">mentions_edge</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;doc_456&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;concept_789&quot;</span><span class="p">,</span>
    <span class="n">relation</span><span class="o">=</span><span class="s2">&quot;MENTIONS&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;relevance&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">relates_edge</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;concept_789&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;concept_async_io&quot;</span><span class="p">,</span>
    <span class="n">relation</span><span class="o">=</span><span class="s2">&quot;RELATED_TO&quot;</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="mf">0.87</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="building-the-graph">Building the Graph</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">KnowledgeGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Knowledge graph for GraphRAG</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a node to the graph&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="c1"># Generate embedding for semantic search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_embedding</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="n">Edge</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a relationship between nodes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create vector embedding for node&quot;&quot;&quot;</span>
        <span class="c1"># Combine node type, properties into text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">embedding_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find connected nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            node_id: Starting node</span>
<span class="sd">            relation: Filter by relationship type (optional)</span>
<span class="sd">            hops: Number of relationships to traverse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_nodes</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_id</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hops</span><span class="p">):</span>
            <span class="n">next_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span> <span class="ow">in</span> <span class="n">current_nodes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">relation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">edge</span><span class="o">.</span><span class="n">relation</span> <span class="o">==</span> <span class="n">relation</span><span class="p">:</span>
                        <span class="n">next_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                        <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="p">])</span>
            <span class="n">current_nodes</span> <span class="o">=</span> <span class="n">next_nodes</span>

        <span class="k">return</span> <span class="n">neighbors</span>


<span class="c1"># Usage</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">KnowledgeGraph</span><span class="p">()</span>

<span class="c1"># Add nodes</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">person_node</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">document_node</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">concept_node</span><span class="p">)</span>

<span class="c1"># Add relationships</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">authored_edge</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">mentions_edge</span><span class="p">)</span>

<span class="c1"># Find related content</span>
<span class="n">related_docs</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">find_neighbors</span><span class="p">(</span><span class="s2">&quot;person_123&quot;</span><span class="p">,</span> <span class="n">relation</span><span class="o">=</span><span class="s2">&quot;AUTHORED&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sarah authored </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">related_docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="deep-dive-graphrag-retrieval">ğŸ”¬ Deep Dive: GraphRAG Retrieval</h2>
<h3 id="multi-hop-retrieval">Multi-Hop Retrieval</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GraphRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RAG system enhanced with knowledge graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">knowledge_graph</span><span class="p">:</span> <span class="n">KnowledgeGraph</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">knowledge_graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_with_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve documents with graph context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Vector similarity search (like traditional RAG)</span>
        <span class="n">initial_results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Step 2: Expand with graph relationships</span>
        <span class="n">expanded_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">initial_results</span><span class="p">:</span>
            <span class="c1"># Get the node from graph</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span>

            <span class="c1"># Find related nodes through graph traversal</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">find_neighbors</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="n">max_hops</span><span class="p">)</span>

            <span class="n">expanded_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;primary&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
                <span class="s1">&#39;related_entities&#39;</span><span class="p">:</span> <span class="n">neighbors</span><span class="p">,</span>
                <span class="s1">&#39;relationship_paths&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_paths</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="n">expanded_results</span><span class="p">,</span>
            <span class="s1">&#39;graph_context&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_subgraph</span><span class="p">(</span><span class="n">expanded_results</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find relationship paths between nodes&quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_shortest_path</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">build_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build subgraph from retrieved results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">][</span><span class="s1">&#39;node_id&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;related_entities&#39;</span><span class="p">]:</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="c1"># Get edges between these nodes</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="n">edge</span><span class="o">.</span><span class="n">target</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">],</span>
            <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">edges</span>
        <span class="p">}</span>
</code></pre></div>

<h3 id="relationship-aware-generation">Relationship-Aware Generation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">generate_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate answer using graph context</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve with graph expansion</span>
    <span class="n">retrieval</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_with_context</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Build rich context from graph</span>
    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_graph_context</span><span class="p">(</span><span class="n">retrieval</span><span class="p">)</span>

    <span class="c1"># Generate with relationship awareness</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Answer this question using the provided information and relationships:</span>

<span class="s2">    Question: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">    Primary Documents:</span>
<span class="s2">    </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_documents</span><span class="p">(</span><span class="n">retrieval</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">])</span><span class="si">}</span>

<span class="s2">    Related Entities and Relationships:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;entity_relationships&#39;</span><span class="p">]</span><span class="si">}</span>

<span class="s2">    Knowledge Graph Context:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;graph_structure&#39;</span><span class="p">]</span><span class="si">}</span>

<span class="s2">    Provide an answer that:</span>
<span class="s2">    1. Uses information from primary documents</span>
<span class="s2">    2. Incorporates relevant relationships</span>
<span class="s2">    3. Explains how entities are connected</span>
<span class="s2">    4. Cites sources with relationship context</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">answer</span>

<span class="k">def</span> <span class="nf">format_graph_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retrieval</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format graph information for LLM</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subgraph</span> <span class="o">=</span> <span class="n">retrieval</span><span class="p">[</span><span class="s1">&#39;graph_context&#39;</span><span class="p">]</span>

    <span class="c1"># Format entities</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
        <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Format relationships</span>
    <span class="n">relationships</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="n">relationships</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> --[</span><span class="si">{</span><span class="n">edge</span><span class="o">.</span><span class="n">relation</span><span class="si">}</span><span class="s2">]--&gt; </span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;entity_relationships&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationships</span><span class="p">),</span>
        <span class="s1">&#39;graph_structure&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;entities&#39;</span><span class="p">:</span> <span class="n">entities</span><span class="p">,</span>
            <span class="s1">&#39;connections&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">subgraph</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<h2 id="quick-win-simple-graphrag-implementation">âš¡ Quick Win: Simple GraphRAG Implementation</h2>
<h3 id="30-minute-graph-enhanced-rag">30-Minute Graph-Enhanced RAG</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span> <span class="nc">SimpleGraphRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lightweight GraphRAG for quick implementation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">add_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add document with metadata&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">metadata</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_embedding</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">related_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Link documents via relationships&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">related_id</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">relation_type</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">include_related</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search with optional graph expansion&quot;&quot;&quot;</span>
        <span class="c1"># Semantic search</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="n">create_embedding</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_similar</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include_related</span><span class="p">:</span>
            <span class="c1"># Expand with related documents</span>
            <span class="n">expanded</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">doc_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

                <span class="c1"># Add related documents</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relationships</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]:</span>
                    <span class="n">related_doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="p">[</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span>
                    <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">related_doc</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;relationship&#39;</span><span class="p">:</span> <span class="n">rel</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;via&#39;</span><span class="p">:</span> <span class="n">doc_id</span>
                    <span class="p">})</span>

            <span class="k">return</span> <span class="n">expanded</span>

        <span class="k">return</span> <span class="n">results</span>


<span class="c1"># Usage</span>
<span class="n">graph_rag</span> <span class="o">=</span> <span class="n">SimpleGraphRAG</span><span class="p">()</span>

<span class="c1"># Add documents</span>
<span class="n">graph_rag</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
    <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FastAPI is a modern Python web framework&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Author1&quot;</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">graph_rag</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span>
    <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Building async APIs with Python&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Author1&quot;</span><span class="p">,</span> <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;Python&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Add relationships</span>
<span class="n">graph_rag</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span> <span class="s2">&quot;RELATED_TOPIC&quot;</span><span class="p">)</span>
<span class="n">graph_rag</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span> <span class="s2">&quot;SAME_AUTHOR&quot;</span><span class="p">)</span>

<span class="c1"># Search with graph expansion</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">graph_rag</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Python web frameworks&quot;</span><span class="p">,</span> <span class="n">include_related</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relationship&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PRIMARY&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="advanced-complex-graph-patterns">ğŸŒ³ Advanced: Complex Graph Patterns</h2>
<h3 id="community-detection-for-better-retrieval">Community Detection for Better Retrieval</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CommunityGraphRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GraphRAG with community detection for topic clustering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">KnowledgeGraph</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">communities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_communities</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">detect_communities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect communities (clusters) in the graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simplified community detection</span>
        <span class="c1"># In production, use algorithms like Louvain or Label Propagation</span>
        <span class="n">communities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">community_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="c1"># BFS to find connected component</span>
                <span class="n">community</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bfs_component</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">community</span><span class="p">:</span>
                    <span class="n">communities</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_id</span>
                <span class="n">community_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">communities</span>

    <span class="k">def</span> <span class="nf">retrieve_from_community</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve from the most relevant community</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find most relevant node</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="n">create_embedding</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">most_similar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_most_similar_node</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">)</span>

        <span class="c1"># Get its community</span>
        <span class="n">community_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">communities</span><span class="p">[</span><span class="n">most_similar</span><span class="p">]</span>

        <span class="c1"># Retrieve all nodes from that community</span>
        <span class="n">community_nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node_id</span> <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">comm_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">comm_id</span> <span class="o">==</span> <span class="n">community_id</span>
        <span class="p">]</span>

        <span class="c1"># Return community documents</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">community_nodes</span><span class="p">]</span>
</code></pre></div>

<h3 id="temporal-graphs-for-time-aware-retrieval">Temporal Graphs for Time-Aware Retrieval</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TemporalGraphRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GraphRAG with temporal relationships</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">KnowledgeGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_edges</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_temporal_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                         <span class="n">relation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add time-stamped relationship&quot;&quot;&quot;</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;valid_from&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve considering temporal validity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Filter edges valid at given time</span>
        <span class="n">valid_edges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temporal_edges</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;valid_from&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">timestamp</span>
        <span class="p">]</span>

        <span class="c1"># Build temporal subgraph</span>
        <span class="n">temporal_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_temporal_subgraph</span><span class="p">(</span><span class="n">valid_edges</span><span class="p">)</span>

        <span class="c1"># Query on temporal graph</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_from_graph</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">temporal_graph</span><span class="p">)</span>
</code></pre></div>

<h2 id="real-world-use-cases">ğŸ¯ Real-World Use Cases</h2>
<h3 id="1-technical-documentation">1. Technical Documentation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Build knowledge graph of documentation</span>
<span class="n">docs_graph</span> <span class="o">=</span> <span class="n">KnowledgeGraph</span><span class="p">()</span>

<span class="c1"># Nodes: Documents, APIs, Concepts, Examples</span>
<span class="n">docs_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;api_auth&quot;</span><span class="p">,</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentication API&quot;</span><span class="p">}))</span>
<span class="n">docs_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;guide_auth&quot;</span><span class="p">,</span> <span class="s2">&quot;guide&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Auth Guide&quot;</span><span class="p">}))</span>
<span class="n">docs_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;concept_oauth&quot;</span><span class="p">,</span> <span class="s2">&quot;concept&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;OAuth 2.0&quot;</span><span class="p">}))</span>

<span class="c1"># Relationships</span>
<span class="n">docs_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;guide_auth&quot;</span><span class="p">,</span> <span class="s2">&quot;api_auth&quot;</span><span class="p">,</span> <span class="s2">&quot;DOCUMENTS&quot;</span><span class="p">))</span>
<span class="n">docs_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;api_auth&quot;</span><span class="p">,</span> <span class="s2">&quot;concept_oauth&quot;</span><span class="p">,</span> <span class="s2">&quot;IMPLEMENTS&quot;</span><span class="p">))</span>

<span class="c1"># Query: &quot;How do I implement authentication?&quot;</span>
<span class="c1"># Result: Guide + API docs + OAuth concept + related examples</span>
</code></pre></div>

<h3 id="2-enterprise-knowledge-base">2. Enterprise Knowledge Base</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Nodes: Employees, Projects, Documents, Skills</span>
<span class="n">kb_graph</span> <span class="o">=</span> <span class="n">KnowledgeGraph</span><span class="p">()</span>

<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;emp_sarah&quot;</span><span class="p">,</span> <span class="s2">&quot;employee&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sarah&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Engineer&quot;</span><span class="p">}))</span>
<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;proj_api&quot;</span><span class="p">,</span> <span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;API Redesign&quot;</span><span class="p">}))</span>
<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="s2">&quot;doc_design&quot;</span><span class="p">,</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;API Design Doc&quot;</span><span class="p">}))</span>

<span class="c1"># Relationships</span>
<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;emp_sarah&quot;</span><span class="p">,</span> <span class="s2">&quot;proj_api&quot;</span><span class="p">,</span> <span class="s2">&quot;WORKS_ON&quot;</span><span class="p">))</span>
<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;emp_sarah&quot;</span><span class="p">,</span> <span class="s2">&quot;doc_design&quot;</span><span class="p">,</span> <span class="s2">&quot;AUTHORED&quot;</span><span class="p">))</span>
<span class="n">kb_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;doc_design&quot;</span><span class="p">,</span> <span class="s2">&quot;proj_api&quot;</span><span class="p">,</span> <span class="s2">&quot;DESCRIBES&quot;</span><span class="p">))</span>

<span class="c1"># Query: &quot;Who knows about API design?&quot;</span>
<span class="c1"># Result: Sarah + her projects + related documents + her expertise</span>
</code></pre></div>

<h3 id="3-research-papers">3. Research Papers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Nodes: Papers, Authors, Concepts, Citations</span>
<span class="n">research_graph</span> <span class="o">=</span> <span class="n">KnowledgeGraph</span><span class="p">()</span>

<span class="c1"># Build citation network</span>
<span class="n">research_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;paper_new&quot;</span><span class="p">,</span> <span class="s2">&quot;paper_old&quot;</span><span class="p">,</span> <span class="s2">&quot;CITES&quot;</span><span class="p">))</span>
<span class="n">research_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;paper_new&quot;</span><span class="p">,</span> <span class="s2">&quot;author_smith&quot;</span><span class="p">,</span> <span class="s2">&quot;AUTHORED_BY&quot;</span><span class="p">))</span>
<span class="n">research_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s2">&quot;paper_new&quot;</span><span class="p">,</span> <span class="s2">&quot;concept_transformer&quot;</span><span class="p">,</span> <span class="s2">&quot;DISCUSSES&quot;</span><span class="p">))</span>

<span class="c1"># Query: &quot;Recent work on transformers&quot;</span>
<span class="c1"># Result: Recent papers + citing papers + related concepts + author networks</span>
</code></pre></div>

<h2 id="key-takeaways">ğŸ¯ Key Takeaways</h2>
<ul>
<li><strong>GraphRAG adds relationship understanding</strong> to traditional RAG</li>
<li><strong>Multi-hop traversal</strong> discovers indirect connections</li>
<li><strong>Community detection</strong> finds topic clusters</li>
<li><strong>Temporal graphs</strong> enable time-aware retrieval</li>
<li><strong>Subgraph extraction</strong> provides rich context</li>
</ul>
<h2 id="when-to-use-graphrag">When to Use GraphRAG</h2>
<h3 id="use-traditional-rag-when">Use Traditional RAG When:</h3>
<ul>
<li>Documents are independent</li>
<li>Simple similarity is sufficient</li>
<li>Performance is critical</li>
<li>Graph construction overhead too high</li>
</ul>
<h3 id="use-graphrag-when">Use GraphRAG When:</h3>
<ul>
<li>Relationships matter (org charts, citations, dependencies)</li>
<li>Need to explain connections</li>
<li>Multi-hop reasoning required</li>
<li>Domain has natural graph structure</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>Continue to <a href="./04-grounding.md">Grounding Techniques</a> to learn advanced methods for keeping your agents accurate and reliable.</p>
<hr />
<p>ğŸ’¡ <strong>Remember</strong>: GraphRAG shines when understanding "how things connect" is as important as finding "what matches."</p>
                </div>
                
                <footer class="book-footer">
                    <div class="book-footer-content">
                        <p>Built with BookGen - A modern GitBook alternative</p>
                        <p>Generated on 2025-11-15 19:18:13</p>
                    </div>
                </footer>
            </main>
            
            
        </div>
    </div>
    
    <script src="/assets/script.js"></script>
</body>
</html>