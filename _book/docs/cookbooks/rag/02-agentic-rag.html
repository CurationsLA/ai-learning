<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open-source frameworks, guides, and resources for AI development, collaboration, and creativity">
    <meta name="author" content="VibeHub">
    <title>Agentic RAG - VibeHub - Human Ã— AI Creative Agency</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="/assets/highlight.css">
</head>
<body>
    <div class="book-container">
        <div class="book-header">
            <div class="book-header-content">
                <h1 class="book-title">VibeHub - Human Ã— AI Creative Agency</h1>
                <div class="book-header-controls">
                    <input type="search" class="search-input" placeholder="Search..." id="search-input">
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                        <span class="theme-icon">ğŸŒ“</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="book-body">
            <nav class="book-sidebar">
<div class="book-sidebar-content">
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ  Welcome to CURATIONS</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/readme.html">Start Here</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curations.html">About CURATIONS</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/about-curationsla.html">About CurationsLA</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸŒŸ Core Initiatives</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/the-curators.html">The Curators (AI Personas)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/youth-curator-movement.html">Youth Curator Movement</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¨ How We Build</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/design-systems.html">Design Systems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/technical-architecture.html">Technical Architecture</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ“š The AI Ã— Human Cookbook</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/README.html">About the Cookbook</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸŒ± Foundations: AI Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/01-interoperability-intro.html">Introduction to Interoperability</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/02-model-garden.html">Model Garden & Foundation Models</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/foundations/03-memory-management.html">Memory Management</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ” RAG & Knowledge Systems</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/01-rag-fundamentals.html">RAG Fundamentals</a>
</li>
<li class="sidebar-item active">
  <a href="/docs/cookbooks/rag/02-agentic-rag.html">Agentic RAG</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/03-graph-rag.html">GraphRAG</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/rag/04-grounding.html">Grounding Techniques</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¤– Agent Development</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/01-adk-overview.html">Agent Development Kits (ADK)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/02-agent-types.html">Agent Types</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/03-agent-models.html">Agent Models & Contracts</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/agents/04-defining-llm-agents.html">Defining LLM Agents</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ› ï¸ Tools & Integration</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/01-mcp.html">Model Context Protocol (MCP)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/02-a2a.html">Agent2Agent Protocol (A2A)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/03-tool-ecosystems.html">Tool Ecosystems</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/tools/04-agent-engines.html">AI Agent Engines</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ§  Advanced Prompting</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/README.html">Overview: Advanced Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/context-manipulation.html">Context Manipulation</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/emoji-protocol.html">Emoji Protocol</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/meta-prompting.html">Meta-Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/quantum-prompting.html">Quantum Prompting</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/advanced-prompting/temporal-debugging.html">Temporal Debugging</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¨ Business: Branding & Growth</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/README.html">Overview: AI-Powered Business</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/quantum-brand-engine.html">Quantum Brand Engine</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/brand-archaeology.html">Brand Archaeology</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/ai-discovery-singularity.html">AI Discovery Singularity (AAO)</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/schema-mastery.html">Schema.org Mastery</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/business/creator-engine.html">Creator Singularity Engine</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸš€ Going Legendary</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/full-stack-ai.html">Full-Stack AI Applications</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/production-deployment.html">Production Deployment</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/scaling.html">Scaling Strategies</a>
</li>
<li class="sidebar-item ">
  <a href="/docs/cookbooks/legendary/the-future.html">The Future We're Building</a>
</li>
</ul>
</div>
<div class="sidebar-section">
<h3 class="sidebar-section-title">ğŸ¤ Get Involved</h3>
<ul class="sidebar-list">
<li class="sidebar-item ">
  <a href="/docs/get-involved.html">How to Contribute, Learn & Collaborate</a>
</li>
</ul>
</div>
</div>
</nav>

            
            <main class="book-main">
                <div class="book-content">
                    <h1 id="agentic-rag-active-reasoning-in-knowledge-search">ğŸ¯ Agentic RAG: Active Reasoning in Knowledge Search</h1>
<h2 id="growing-concept">ğŸŒ¿ Growing Concept</h2>
<p><strong>Label</strong>: From Passive Retrieval to Active Reasoning</p>
<p>Agentic RAG transforms agents from passive recipients of retrieved data into active, reasoning participants in the search for knowledge. Instead of blindly accepting the first retrieval results, agents can reason about what they need, reformulate queries, and validate information.</p>
<h2 id="what-is-agentic-rag">What is Agentic RAG?</h2>
<h3 id="the-evolution">The Evolution</h3>
<div class="codehilite"><pre><span></span><code>Traditional RAG:           Agentic RAG:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query   â”‚              â”‚  Query   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                         â”‚
     â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve â”‚              â”‚  Analyze â”‚â—„â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚   Need   â”‚  â”‚
     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
     â”‚                         â”‚        â”‚
     â–¼                         â–¼        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Generate â”‚              â”‚ Retrieve â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
                               â”‚        â”‚
                               â–¼        â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                          â”‚ Validate â”‚  â”‚
                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
                               â”‚        â”‚
                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
                          â”‚Sufficient?â”œâ”€â”€â”˜
                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ No
                               â”‚ Yes
                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Generate â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>

<h2 id="key-capabilities">ğŸ’¡ Key Capabilities</h2>
<h3 id="1-query-decomposition">1. Query Decomposition</h3>
<p>Breaking complex queries into manageable sub-queries:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AgenticRetriever</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Agentic retrieval system with reasoning capabilities</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_store</span><span class="p">,</span> <span class="n">llm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">vector_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_engine</span> <span class="o">=</span> <span class="n">ReasoningEngine</span><span class="p">(</span><span class="n">llm</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">decompose_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complex_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Break down complex query into sub-queries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">decomposition_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Break down this complex question into 3-5 simpler sub-questions</span>
<span class="s2">        that can be answered independently:</span>

<span class="s2">        Question: </span><span class="si">{</span><span class="n">complex_query</span><span class="si">}</span>

<span class="s2">        Sub-questions (one per line):</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">decomposition_prompt</span><span class="p">)</span>
        <span class="n">sub_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

        <span class="k">return</span> <span class="n">sub_queries</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_for_subquery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve documents for a single sub-query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Multiple retrieval strategies</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Strategy 1: Direct semantic search</span>
        <span class="n">semantic_results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">sub_query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">semantic_results</span><span class="p">)</span>

        <span class="c1"># Strategy 2: Reformulated query</span>
        <span class="n">reformulated</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reformulate_query</span><span class="p">(</span><span class="n">sub_query</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reformulated</span> <span class="o">!=</span> <span class="n">sub_query</span><span class="p">:</span>
            <span class="n">alt_results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">reformulated</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">alt_results</span><span class="p">)</span>

        <span class="c1"># Deduplicate and rank</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deduplicate_and_rank</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">reformulate_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reformulate query for better retrieval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Reformulate this query to improve search results.</span>
<span class="s2">        Use synonyms and related terms:</span>

<span class="s2">        Original: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>
<span class="s2">        Reformulated:</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>


<span class="c1"># Example usage</span>
<span class="n">agentic</span> <span class="o">=</span> <span class="n">AgenticRetriever</span><span class="p">(</span><span class="n">vector_store</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>

<span class="c1"># Complex query that needs decomposition</span>
<span class="n">complex_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">How does our company&#39;s return policy compare to industry standards,</span>
<span class="s2">and what are the financial implications of extending the return window?</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Agent breaks it down</span>
<span class="n">sub_queries</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agentic</span><span class="o">.</span><span class="n">decompose_query</span><span class="p">(</span><span class="n">complex_query</span><span class="p">)</span>
<span class="c1"># Result: </span>
<span class="c1"># 1. &quot;What is our company&#39;s current return policy?&quot;</span>
<span class="c1"># 2. &quot;What are typical return policies in our industry?&quot;</span>
<span class="c1"># 3. &quot;What are the costs associated with product returns?&quot;</span>
<span class="c1"># 4. &quot;How does return window length affect return rates?&quot;</span>
</code></pre></div>

<h3 id="2-self-reflection-and-validation">2. Self-Reflection and Validation</h3>
<p>Agents validate retrieved information quality:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SelfReflectingRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RAG system that validates its own retrievals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_with_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve and validate information quality</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initial retrieval</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Self-reflection: Are results relevant?</span>
        <span class="n">validation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">validation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="c1"># Results not good enough, try different approach</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">advanced_retrieval</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">validation</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">validation</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">],</span>
            <span class="s2">&quot;reasoning&quot;</span><span class="p">:</span> <span class="n">validation</span><span class="p">[</span><span class="s1">&#39;reasoning&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">validate_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Agent validates retrieval quality</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">validation_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">        Retrieved documents:</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        Evaluate:</span>
<span class="s2">        1. Do these documents answer the query? (Yes/No/Partially)</span>
<span class="s2">        2. What&#39;s missing?</span>
<span class="s2">        3. Confidence score (0-1):</span>

<span class="s2">        Respond in JSON format.</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">validation_prompt</span><span class="p">)</span>
        <span class="n">validation</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;issues&#39;</span><span class="p">:</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s1">&#39;reasoning&#39;</span><span class="p">:</span> <span class="n">validation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reasoning&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">advanced_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">issues</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try alternative retrieval strategies based on identified issues</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strategies</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s2">&quot;specific numbers&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">issues</span><span class="p">):</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;numeric_search&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;recent information&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">issues</span><span class="p">):</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;time_filtered_search&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;comparative data&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">issues</span><span class="p">):</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;comparative_search&quot;</span><span class="p">)</span>

        <span class="c1"># Execute strategies</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="n">strategies</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
            <span class="n">all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_and_merge</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-iterative-refinement">3. Iterative Refinement</h3>
<p>Agents refine their search based on intermediate results:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">IterativeRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RAG that iteratively refines its knowledge gathering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">iterative_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iteratively gather and refine information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">knowledge</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_query</span> <span class="o">=</span> <span class="n">query</span>

        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
            <span class="c1"># Retrieve new information</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">current_query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">knowledge</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

            <span class="c1"># Analyze knowledge gaps</span>
            <span class="n">analysis</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_knowledge_state</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">knowledge</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_sufficient&#39;</span><span class="p">]:</span>
                <span class="k">break</span>

            <span class="c1"># Generate refined query for next iteration</span>
            <span class="n">current_query</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_followup_query</span><span class="p">(</span>
                <span class="n">original_query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
                <span class="n">current_knowledge</span><span class="o">=</span><span class="n">knowledge</span><span class="p">,</span>
                <span class="n">gaps</span><span class="o">=</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;gaps&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: Searching for: </span><span class="si">{</span><span class="n">current_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;knowledge&quot;</span><span class="p">:</span> <span class="n">knowledge</span><span class="p">,</span>
            <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;final_confidence&quot;</span><span class="p">:</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">analyze_knowledge_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">knowledge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if we have enough information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Original question: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">        Information gathered so far:</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">summarize_knowledge</span><span class="p">(</span><span class="n">knowledge</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        Analysis:</span>
<span class="s2">        1. Can we answer the original question? (Yes/No/Partially)</span>
<span class="s2">        2. What critical information is still missing?</span>
<span class="s2">        3. Confidence level (0-1):</span>

<span class="s2">        Respond in JSON.</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">analysis_prompt</span><span class="p">)</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_sufficient&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;can_answer&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gaps&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_followup_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                                     <span class="n">current_knowledge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
                                     <span class="n">gaps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate refined query to fill knowledge gaps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Original question: </span><span class="si">{</span><span class="n">original_query</span><span class="si">}</span>

<span class="s2">        We already know:</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">summarize_knowledge</span><span class="p">(</span><span class="n">current_knowledge</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        What we&#39;re still missing:</span>
<span class="s2">        </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gaps</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        Generate a focused search query to find the missing information:</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</code></pre></div>

<h2 id="deep-dive-multi-strategy-retrieval">ğŸ”¬ Deep Dive: Multi-Strategy Retrieval</h2>
<h3 id="intelligent-strategy-selection">Intelligent Strategy Selection</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MultiStrategyAgenticRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Agentic RAG that selects optimal retrieval strategies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;semantic&#39;</span><span class="p">:</span> <span class="n">SemanticSearch</span><span class="p">(),</span>
            <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="n">KeywordSearch</span><span class="p">(),</span>
            <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="n">HybridSearch</span><span class="p">(),</span>
            <span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="n">GraphSearch</span><span class="p">(),</span>
            <span class="s1">&#39;temporal&#39;</span><span class="p">:</span> <span class="n">TemporalSearch</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">adaptive_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically select and combine retrieval strategies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Analyze query characteristics</span>
        <span class="n">query_analysis</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Select appropriate strategies</span>
        <span class="n">selected_strategies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_strategies</span><span class="p">(</span><span class="n">query_analysis</span><span class="p">)</span>

        <span class="c1"># Execute strategies in parallel</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="n">selected_strategies</span>
        <span class="p">])</span>

        <span class="c1"># Intelligently merge results</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">intelligent_merge</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">query_analysis</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">merged</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">analyze_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Understand query intent and characteristics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Analyze this query:</span>
<span class="s2">        &quot;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="s2">        Determine:</span>
<span class="s2">        1. Intent: [factual, comparative, analytical, procedural]</span>
<span class="s2">        2. Temporal aspect: [recent, historical, timeless]</span>
<span class="s2">        3. Complexity: [simple, moderate, complex]</span>
<span class="s2">        4. Domain: [general, technical, specific]</span>

<span class="s2">        JSON response:</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">analysis_prompt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_strategies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose optimal strategies based on query analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strategies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;semantic&#39;</span><span class="p">]</span>  <span class="c1"># Always include semantic</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;temporal&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;recent&#39;</span><span class="p">:</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;temporal&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;complexity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;hybrid&#39;</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;technical&#39;</span> <span class="ow">in</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]:</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">strategies</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">intelligent_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_by_strategy</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]],</span> 
                               <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge results with strategy-aware ranking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Weight strategies based on query analysis</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_strategy_weights</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>

        <span class="c1"># Combine with weighted scoring</span>
        <span class="n">scored_docs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">strategy_name</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategies</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">results_by_strategy</span><span class="p">):</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">strategy_name</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
                <span class="n">doc_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">scored_docs</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">scored_docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">score</span>

        <span class="c1"># Return top-ranked documents</span>
        <span class="n">top_docs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scored_docs</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_document</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">top_docs</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</code></pre></div>

<h2 id="quick-win-basic-agentic-enhancement">âš¡ Quick Win: Basic Agentic Enhancement</h2>
<p>Add simple reasoning to existing RAG:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EnhancedRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple agentic improvements to basic RAG&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">smart_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="c1"># 1. Generate alternative phrasings</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">query</span><span class="p">,</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rephrase</span><span class="p">(</span><span class="n">query</span><span class="p">),</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_with_synonyms</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># 2. Retrieve with each</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alt_query</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">alt_query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="c1"># 3. Deduplicate and rank</span>
        <span class="n">unique_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deduplicate</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span>

        <span class="c1"># 4. Validate relevance</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unique_results</span> <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_relevant</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">r</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">filtered</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div>

<h2 id="advanced-reasoning-chains">ğŸŒ³ Advanced: Reasoning Chains</h2>
<h3 id="chain-of-thought-retrieval">Chain-of-Thought Retrieval</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ChainOfThoughtRAG</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RAG with explicit reasoning chains</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_with_reasoning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show reasoning process explicitly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reasoning_chain</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Step 1: Understand query</span>
        <span class="n">understanding</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">understand_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">reasoning_chain</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;understanding&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;This query is asking for </span><span class="si">{</span><span class="n">understanding</span><span class="p">[</span><span class="s1">&#39;intent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">})</span>

        <span class="c1"># Step 2: Plan retrieval</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">plan_retrieval</span><span class="p">(</span><span class="n">understanding</span><span class="p">)</span>
        <span class="n">reasoning_chain</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;planning&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;I&#39;ll search for: </span><span class="si">{</span><span class="n">plan</span><span class="p">[</span><span class="s1">&#39;search_terms&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">})</span>

        <span class="c1"># Step 3: Execute and evaluate</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="s1">&#39;search_terms&#39;</span><span class="p">])</span>
        <span class="n">evaluation</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="n">reasoning_chain</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;evaluation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results. Relevance: </span><span class="si">{</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">})</span>

        <span class="c1"># Step 4: Decide if more retrieval needed</span>
        <span class="k">if</span> <span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">reasoning_chain</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;refinement&quot;</span><span class="p">,</span>
                <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="s2">&quot;Results insufficient, trying alternative approach&quot;</span>
            <span class="p">})</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternative_retrieval</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
            <span class="s2">&quot;reasoning_chain&quot;</span><span class="p">:</span> <span class="n">reasoning_chain</span>
        <span class="p">}</span>
</code></pre></div>

<h2 id="key-takeaways">ğŸ¯ Key Takeaways</h2>
<ul>
<li><strong>Agentic RAG adds reasoning</strong> to the retrieval process</li>
<li><strong>Self-reflection</strong> improves retrieval quality</li>
<li><strong>Iterative refinement</strong> fills knowledge gaps</li>
<li><strong>Strategy selection</strong> optimizes for query type</li>
<li><strong>Transparency</strong> through reasoning chains builds trust</li>
</ul>
<h2 id="when-to-use-agentic-rag">When to Use Agentic RAG</h2>
<h3 id="use-traditional-rag-when">Use Traditional RAG When:</h3>
<ul>
<li>Queries are straightforward</li>
<li>Speed is critical</li>
<li>Information is well-organized</li>
</ul>
<h3 id="use-agentic-rag-when">Use Agentic RAG When:</h3>
<ul>
<li>Queries are complex or ambiguous</li>
<li>Information quality is paramount</li>
<li>Multiple perspectives needed</li>
<li>Knowledge is fragmented</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<p>Continue to <a href="./03-graph-rag.md">GraphRAG</a> to learn how to leverage relationship graphs for even more sophisticated knowledge retrieval.</p>
<hr />
<p>ğŸ’¡ <strong>Remember</strong>: Agentic RAG is about making your agent an active participant in finding the right information, not just a passive consumer.</p>
                </div>
                
                <footer class="book-footer">
                    <div class="book-footer-content">
                        <p>Built with BookGen - A modern GitBook alternative</p>
                        <p>Generated on 2025-11-15 19:18:13</p>
                    </div>
                </footer>
            </main>
            
            
        </div>
    </div>
    
    <script src="/assets/script.js"></script>
</body>
</html>